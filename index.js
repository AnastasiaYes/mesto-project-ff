(()=>{"use strict";var e={866:(e,t,n)=>{n.d(t,{Eg:()=>i,I1:()=>u,Rx:()=>d,gm:()=>l,gw:()=>p,oS:()=>c,to:()=>s,wz:()=>a});var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-13",headers:{authorization:"fd771050-e342-49ab-8ca0-e1af1272aab8","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function a(){return fetch("".concat(r.baseUrl,"/users/me"),{method:"GET",headers:r.headers}).then(o)}function c(e,t){return fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})}).then(o)}function u(e){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then(o)}function i(){return fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then(o)}function l(e,t){return fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e,link:t})}).then(o)}function s(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then(o)}function d(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then(o)}function p(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then(o)}},694:(e,t,n)=>{n.d(t,{Lq:()=>o,io:()=>c,uu:()=>a});var r=n(866);function o(e){(0,r.to)(e.dataset.id).then((function(t){console.log(e.dataset.id),e.remove()})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))}function a(e,t,n,r,o,a,c,l,s){var d=e._id,p=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);u(p,t,r),i(p,r.length);var f=p.querySelector(".card__image"),m=p.querySelector(".card__like-button");return f.src=a,f.alt=o,p.querySelector(".card__title").textContent=o,r.includes(d)&&m.classList.add("card__like-button_is-active"),n!==d?p.querySelector(".card__delete-button").remove():c&&p.querySelector(".card__delete-button").addEventListener("click",(function(){c(p)})),l&&m.addEventListener("click",(function(){l(m,e._id)})),s&&f.addEventListener("click",s),p}function c(e,t){var n=e.closest(".card"),o=n.dataset.id;n.dataset.like.split(";").includes(t)?(0,r.gw)(o).then((function(t){e.classList.remove("card__like-button_is-active"),u(n,t._id,t.likes.map((function(e){return e._id}))),i(n,t.likes.length)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})):(0,r.Rx)(o).then((function(t){u(n,t._id,t.likes.map((function(e){return e._id}))),e.classList.add("card__like-button_is-active"),i(n,t.likes.length)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)}))}function u(e,t,n){e.dataset.id=t,e.dataset.like=n.join(";")}function i(e,t){e.querySelector(".number-likes").textContent=t}},947:(e,t,n)=>{function r(e){e.classList.add("popup_is-animated"),setTimeout((function(){return e.classList.add("popup_is-opened")}),0),document.addEventListener("keydown",a)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&o(document.querySelector(".popup.popup_is-opened"))}function c(e){var t=e.currentTarget.closest(".popup_is-opened");t&&o(t)}function u(e){e.target.classList.contains("popup")&&o(e.target)}function i(){document.querySelectorAll(".popup__close").forEach((function(e){return e.addEventListener("click",c)})),document.querySelectorAll(".popup").forEach((function(e){return e.addEventListener("click",u)}))}n.d(t,{Ah:()=>i,PB:()=>r,fs:()=>o})},547:(e,t,n)=>{function r(e){document.querySelectorAll(e.formSelector).forEach((function(t){t.querySelectorAll(e.inputSelector).forEach((function(t){t.addEventListener("input",(function(t){return function(e,t){if(e.validity.valid){var n=u(e);n.valid?(c(e,t.inputErrorClass,t),l(e.closest("form"),t)):a(e,n.message,t)}else a(e,e.validationMessage,t)}(t.currentTarget,e)}))}))}))}function o(e,t){e.classList.add(t),e.disabled=!0}function a(e,t,n){e.classList.add(n.inputErrorClass),o(e.closest("form").querySelector(n.submitButtonSelector),n.inactiveButtonClass);var r=e.nextSibling;"SPAN"!==r.tagName?((r=document.createElement("span")).classList.add(n.errorClass),r.textContent=t,e.parentNode.insertBefore(r,e.nextSibling)):r.textContent=t}function c(e,t,n){e.classList.remove(n.inputErrorClass);var r=e.nextSibling;"SPAN"===r.tagName&&r.remove()}function u(e){var t=new RegExp(e.dataset.validationRegex),n=!1;return e.value.match(t)&&(n=!0),{valid:n,message:e.dataset.errorText}}function i(e,t){e.querySelectorAll(t.inputSelector).forEach((function(e){c(e,t.errorClass,t)})),l(e,t)}function l(e,t){var n,r,a=e.querySelectorAll(t.inputSelector),c=!1;a.forEach((function(e){e.validity.valid&&u(e).valid||(c=!0)})),c?o(e.querySelector(t.submitButtonSelector),t.inactiveButtonClass):(n=e.querySelector(t.submitButtonSelector),r=t.inactiveButtonClass,n.classList.remove(r),n.disabled=!1)}n.d(t,{F:()=>r,R:()=>i})}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(947),t=n(694),r=n(547),o=n(866);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c,u,i,l=document.querySelector(".places__list"),s=document.forms["new-place"],d=document.forms["edit-profile"],p=document.forms["update-avatar"],f=d.elements.name,m=d.elements.description,v=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),h=null,y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function b(t){var n=document.querySelector(".popup.popup_type_image");!function(e,t){var n=document.querySelector(".popup.popup_type_image");n.querySelector(".popup__image").src=e,n.querySelector(".popup__image").alt=t,n.querySelector(".popup__caption").textContent=t}(t.currentTarget.getAttribute("src"),t.currentTarget.getAttribute("alt")),(0,e.PB)(n)}Promise.all([(0,o.wz)(),(0,o.Eg)()]).then((function(e){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,u=[],i=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(n,r)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];v.textContent=c.name,_.textContent=c.about,h=c,document.querySelector(".profile__image").style.backgroundImage='url("'.concat(h.avatar,'")'),u.forEach((function(e){var n=(0,t.uu)(h,e._id,e.owner._id,e.likes.map((function(e){return e._id})),e.name,e.link,t.Lq,t.io,b);l.append(n)}))})).catch((function(e){console.error("Ошибка. Запрос не выполнен: ",e)})),d.addEventListener("submit",(function(t){t.preventDefault();var n=t.target.querySelector(".popup__button");n.textContent="Сохранить...",(0,o.oS)(f.value,m.value).then((function(n){void 0!==n.errors&&alert(n.message),v.textContent=f.value,_.textContent=m.value;var r=t.target.closest(".popup");(0,e.fs)(r)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){return n.textContent="Сохранить"}))})),s.addEventListener("submit",(function(n){return function(n,r,a){n.preventDefault();var c=n.target.querySelector(".popup__button");c.textContent="Сохранить...";var u=a.elements["place-name"].value,i=a.elements.link.value;(0,o.gm)(u,i).then((function(o){void 0!==o.errors&&alert(o.message);var a=(0,t.uu)(h,o._id,o.owner._id,o.likes.map((function(e){return e._id})),u,i,t.Lq,t.io,b);r.prepend(a);var c=n.target.closest(".popup");(0,e.fs)(c)})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){return c.textContent="Сохранить"}))}(n,l,s)})),p.addEventListener("submit",(function(t){return function(t,n){t.preventDefault();var r=t.target.querySelector(".popup__button");r.textContent="Сохранить...";var a=n.elements.link.value;(0,o.I1)(a).then((function(t){t.errors?alert(t.message):(document.querySelector(".profile__image").style.backgroundImage='url("'.concat(a,'")'),(0,e.fs)(n.closest(".popup")))})).catch((function(e){console.log("Ошибка. Запрос не выполнен: ",e)})).finally((function(){return r.textContent="Сохранить"}))}(t,p)})),c=document.querySelector(".profile__edit-button"),u=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__edit-avatar-button"),c.addEventListener("click",(function(){var t=document.querySelector(".popup.popup_type_edit");(0,e.PB)(t),f.value=v.textContent,m.value=_.textContent,(0,r.R)(d,y)})),i.addEventListener("click",(function(){var t=document.querySelector(".popup.popup_type_avatar-update");p.elements.link.value="",(0,e.PB)(t),(0,r.R)(p,y)})),(0,r.F)(y),u.addEventListener("click",(function(){s.reset();var t=document.querySelector(".popup.popup_type_new-card");(0,e.PB)(t),(0,r.R)(s,y)})),(0,e.Ah)()})()})();